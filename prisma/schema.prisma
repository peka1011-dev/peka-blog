// Prisma Schema 파일
// 이 파일은 데이터베이스의 구조를 정의합니다.
// SQLite를 사용하므로 별도의 데이터베이스 서버가 필요 없습니다.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 사용자 모델
// role: ADMIN 또는 USER
// ADMIN은 블로그 글을 작성/수정/삭제할 수 있습니다.
// USER는 댓글만 작성할 수 있습니다.
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // bcrypt로 해시된 비밀번호
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // 관계: 한 사용자는 여러 댓글을 작성할 수 있습니다.
  comments  Comment[]
  
  @@map("users")
}

// 역할 열거형
enum Role {
  ADMIN  // 관리자 (블로그 글 작성 가능)
  USER   // 일반 사용자 (댓글 작성 가능)
}

// 블로그 글 모델
// published: true면 공개, false면 비공개
// slug: URL에 사용되는 고유한 식별자 (예: "kali-linux-basics")
model Post {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique // URL에 사용 (예: /blog/kali-linux-basics)
  content   String   // Markdown 형식의 글 내용
  excerpt   String?  // 글 요약 (SEO용)
  published Boolean  @default(false) // 공개 여부
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // 관계: 한 글에는 여러 댓글이 달릴 수 있습니다.
  comments  Comment[]
  
  @@map("posts")
}

// 댓글 모델
// 로그인한 사용자만 댓글을 작성할 수 있습니다.
model Comment {
  id        String   @id @default(cuid())
  content   String   // 댓글 내용
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // 관계: 댓글은 특정 글에 속합니다.
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  // 관계: 댓글은 특정 사용자가 작성합니다.
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("comments")
}

